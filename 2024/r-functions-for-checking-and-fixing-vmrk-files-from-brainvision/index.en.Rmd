---
title: R functions for checking and fixing vmrk files from BrainVision
author: ''
date: '2024-06-30'
slug: r-functions-for-checking-and-fixing-vmrk-files-from-BrainVision
categories:
  - research methods
  - R
tags:
  - research methods
  - electroencephalography
  - BrainVision
  - event-related potentials
  - s
subtitle: ''
summary: 'Electroencephalography (EEG) has become a cornerstone for understanding the intricate workings of the human brain in the field of neuroscience. However, EEG software and hardware come with their own set of constraints, particularly in the management of markers, also known as triggers. This article aims to shed light on these limitations and future prospects of marker management in EEG studies, while also introducing R functions that can help deal with vmrk files from BrainVision.'
authors: []
lastmod: ''
featured: no
draft: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
---


Electroencephalography (EEG) has become a cornerstone for understanding the intricate workings of the human brain in the field of neuroscience. However, EEG software and hardware come with their own set of constraints, particularly in the management of markers, also known as triggers. This article aims to shed light on these limitations and future prospects of marker management in EEG studies, while also introducing R functions that can help deal with vmrk files from BrainVision.

Markers, serving as timestamps that indicate specific events during data collection, play a crucial role in EEG studies. These events could range from the onset of a stimulus to the participant’s response. However, one of the major constraints in current EEG systems is the limitation of markers to numbers between 1 and 255. This limitation is due to the fact that markers are typically stored as 8-bit unsigned integers in computer memory, which can only represent numbers in the range of 0 to 255. However, the number 0 is usually reserved for system use, leaving only the numbers 1 to 255 available for markers.

This numerical constraint can pose significant challenges in the interpretation of markers, especially in complex experimental designs where a multitude of events need to be marked and differentiated. It necessitates careful documentation of each marker’s purpose prior to running the study. This means that researchers must meticulously map each number to a specific event or condition in their experiment, which can be a daunting task, especially for complex studies with numerous conditions and events.

Looking towards the future, one might wonder if it will become possible to send markers with semantic information, instead of being constrained to numbers between 1 and 255. This would allow researchers to encode more detailed information in each marker, such as the type of stimulus presented or the specific condition being tested. Such a development could revolutionize the way we conduct and analyze EEG studies, offering greater flexibility in experimental design and more nuanced insights into brain activity.

Below, we'll demonstrate some functions from [this GitHub repository](https://github.com/pablobernabeu/EEG-tools-and-tips) that help inspect and fix vmrk files. We'll work with the vmrk file shown below. 

```{r, message=FALSE, warning=FALSE}

# Read the file into a vector of lines
readLines('https://raw.githubusercontent.com/pablobernabeu/EEG-tools-and-tips/main/example.vmrk')

```


## Numbering trials

The antediluvian limitation of markers often prevents us from storing the order of trials using markers. Thus, when we need to inspect or fix vmrk files, we must mentally divide the lines into trials. For instance, in our example vmrk file, all trials begin with the marker `S  5`. The function below allows us to temporarily number trials by appending the number to the first marker of each trial. The parameters of the function allow us to select the `start_line` to skip the metadata at the top of the vmrk file, as well as to select the number of `lines_per_trial` and the `first_number` to use in the first trial. 

<script src="https://emgithub.com/embed-v2.js?target=https%3A%2F%2Fgithub.com%2Fpablobernabeu%2FEEG-tools-and-tips%2Fblob%2Fmain%2Fnumber_trials.R%23L3-L24&style=a11y-dark&type=code&showLineNumbers=on&showFileMeta=on&showCopy=on&fetchFromJsDelivr=on"></script>

```{r, message=FALSE, warning=FALSE}

# Create temporary vmrk file with numbered trials

source('https://raw.githubusercontent.com/pablobernabeu/EEG-tools-and-tips/main/number_trials.R')

number_trials('https://raw.githubusercontent.com/pablobernabeu/EEG-tools-and-tips/main/example.vmrk', 
              start_line = 15, lines_per_trial = 6, first_number = 1)

```


## Removing trial numbers

<script src="https://emgithub.com/embed-v2.js?target=https%3A%2F%2Fgithub.com%2Fpablobernabeu%2FEEG-tools-and-tips%2Fblob%2Fmain%2Fremove_trial_numbers.R%23L3-L20&style=a11y-dark&type=code&showLineNumbers=on&showFileMeta=on&showCopy=on&fetchFromJsDelivr=on"></script>

Now, we will unnumber the trials. This can be especially useful after fixing any errors in the markers. For this demo, we'll use an [example file with numbered trials](https://github.com/pablobernabeu/EEG-tools-and-tips/blob/main/example_numbered_trials.vmrk) that looks just like the output from `number_trials()` shown above. 

```{r, message=FALSE, warning=FALSE}

# Remove trial numbers from temporary vmrk file

source('https://raw.githubusercontent.com/pablobernabeu/EEG-tools-and-tips/main/remove_trial_numbers.R')

remove_trial_numbers('https://raw.githubusercontent.com/pablobernabeu/EEG-tools-and-tips/main/example_numbered_trials.vmrk')

```


## Counting markers

<script src="https://emgithub.com/embed-v2.js?target=https%3A%2F%2Fgithub.com%2Fpablobernabeu%2FEEG-tools-and-tips%2Fblob%2Fmain%2Fcount_markers.R%23L3-L18&style=a11y-dark&type=code&showLineNumbers=on&showFileMeta=on&showCopy=on&fetchFromJsDelivr=on"></script>

```{r, message=FALSE, warning=FALSE}

source('https://raw.githubusercontent.com/pablobernabeu/EEG-tools-and-tips/main/count_markers.R')

count_markers(file = 'https://raw.githubusercontent.com/pablobernabeu/EEG-tools-and-tips/main/example.vmrk', 
              marker = 'S  2')

count_markers(file = 'https://raw.githubusercontent.com/pablobernabeu/EEG-tools-and-tips/main/example.vmrk', 
              marker = 'S  3')

```

